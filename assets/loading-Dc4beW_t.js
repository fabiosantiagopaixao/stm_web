var f=o=>{throw TypeError(o)};var m=(o,e,t)=>e.has(o)||f("Cannot "+t);var p=(o,e,t)=>e.has(o)?f("Cannot add the same private member more than once"):e instanceof WeakSet?e.add(o):e.set(o,t);var c=(o,e,t)=>(m(o,e,"access private method"),t);(function(){const e=document.createElement("link").relList;if(e&&e.supports&&e.supports("modulepreload"))return;for(const r of document.querySelectorAll('link[rel="modulepreload"]'))n(r);new MutationObserver(r=>{for(const s of r)if(s.type==="childList")for(const a of s.addedNodes)a.tagName==="LINK"&&a.rel==="modulepreload"&&n(a)}).observe(document,{childList:!0,subtree:!0});function t(r){const s={};return r.integrity&&(s.integrity=r.integrity),r.referrerPolicy&&(s.referrerPolicy=r.referrerPolicy),r.crossOrigin==="use-credentials"?s.credentials="include":r.crossOrigin==="anonymous"?s.credentials="omit":s.credentials="same-origin",s}function n(r){if(r.ep)return;r.ep=!0;const s=t(r);fetch(r.href,s)}})();const w="stm_data_";var i,l,v,g,u,y;class d{constructor(e=""){p(this,i);this.sheet=e,this.scriptGoogleUrl="https://script.google.com/macros/s/",this.idSheet="AKfycbwR3WVAPyUhzXVUniBlHvKtkcOA7ORiIPZGf4YzD9sCuDKSpbhqYw_IK4nvrqnelBetVw",this.execSheet="/exec?sheet=",this.keyStorage=w+this.sheet}async get(){const e=c(this,i,u).call(this);if(e)return e;const t=c(this,i,l).call(this,this.sheet),n=await fetch(t);if(!n.ok)throw new Error("GET error");const r=await n.json();return r&&c(this,i,g).call(this,r),r}async getByCongregation(e){const t=c(this,i,u).call(this,e);if(t)return t;const n=c(this,i,v).call(this,e),r=await fetch(n);if(!r.ok)throw new Error("GET error");const s=await r.json();return s&&c(this,i,g).call(this,s,e),s}async post(e){return c(this,i,y).call(this,"POST",e)}async put(e){return c(this,i,y).call(this,"PUT",e)}clearStorage(e=null){const t=e?`${this.keyStorage}_${e}`:this.keyStorage;localStorage.removeItem(t)}}i=new WeakSet,l=function(e){const t=e||this.sheet;if(!t)throw new Error("Sheet name not defined");return`${this.scriptGoogleUrl}${this.idSheet}${this.execSheet}${t}`},v=function(e){if(!e)throw new Error("Congregation Number not defined");return`${c(this,i,l).call(this,this.sheet)}&congregation_number=${e}`},g=function(e,t=null){const n=t?`${this.keyStorage}_${t}`:this.keyStorage;localStorage.setItem(n,JSON.stringify(e))},u=function(e=null){const t=e?`${this.keyStorage}_${e}`:this.keyStorage,n=localStorage.getItem(t);return n?JSON.parse(n):null},y=async function(e,t){console.log("[POST][BODY - object]:",t);const n=JSON.stringify(t);console.log("[POST][BODY - json]:",n);const r=`${c(this,i,l).call(this,this.sheet)}&method=${e}`;console.log("[POST][URL]:",r);try{const s=await fetch(r,{method:"POST",headers:{"Content-Type":"application/json"},body:n});if(!s.ok){const S=await s.text();throw console.error("[POST][ERROR RESPONSE]:",S),new Error(`POST error: ${s.status} - ${S}`)}const a=await s.json();return console.log("[POST][RESPONSE]:",a),a}catch(s){throw console.error("[POST][FETCH ERROR]:",s),s}};class L extends d{constructor(){super("congregation")}}class O extends d{constructor(){super("user")}saveUpdate(e){return e.id?this.put(e):this.post(e)}}class x extends d{constructor(){super("territory")}}class E extends d{constructor(){super("address")}}const h="stm_logged_user";class ${constructor(){this.userService=new O,this.territoryService=new x,this.addressService=new E}async login(e,t,n){const r=await this.userService.getByCongregation(e);if(!Array.isArray(r))return null;const s=r.find(a=>String(a.congregation_number)===String(e)&&a.user===t&&String(a.password)===n&&a.active===!0);return s?(this.saveUser(s),s):(this.userService.clearStorage(e),null)}saveUser(e){localStorage.setItem(h,JSON.stringify(e))}getLoggedUser(){const e=localStorage.getItem(h);return e?JSON.parse(e):null}isLogged(){return!!this.getLoggedUser()}logout(){const e=this.getLoggedUser();this.userService.clearStorage(e.congregation_number),this.territoryService.clearStorage(e.congregation_number),this.addressService.clearStorage(e.congregation_number),localStorage.removeItem(h)}}function P(o=null,e="Loading..."){if(o)o.innerHTML=`
      <div class="d-flex flex-column justify-content-center align-items-center text-center"
           style="height: 100%; min-height: 200px;">
        <div class="spinner-border text-primary mb-3" role="status">
          <span class="visually-hidden"></span>
        </div>
        <div class="fw-bold text-primary">${e}</div>
      </div>
    `;else{let t=document.getElementById("app-loading-overlay");t||(t=document.createElement("div"),t.id="app-loading-overlay",t.style.position="fixed",t.style.top=0,t.style.left=0,t.style.width="100%",t.style.height="100%",t.style.background="rgba(255,255,255,0.8)",t.style.display="flex",t.style.flexDirection="column",t.style.justifyContent="center",t.style.alignItems="center",t.style.zIndex=9999,document.body.appendChild(t)),t.innerHTML=`
      <div class="spinner-border text-primary mb-3" role="status">
        <span class="visually-hidden"></span>
      </div>
      <div class="fw-bold text-primary">${e}</div>
    `}}function U(o=null){if(o)o.innerHTML="";else{const e=document.getElementById("app-loading-overlay");e&&e.remove()}}export{E as A,L as C,$ as L,x as T,O as U,U as h,P as s};
